<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карта конкурентного ландшафта GeOnline</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #34495e;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        #chart {
            width: 100%;
            height: 700px;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            background: #fafafa;
            overflow: hidden;
        }

        .competitor {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .competitor:hover {
            stroke: #2c3e50;
            stroke-width: 3px;
        }

        .competitor-label {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            fill: #2c3e50;
        }

        .axis {
            stroke: #7f8c8d;
            stroke-width: 2;
        }

        .axis-label {
            font-size: 14px;
            font-weight: 600;
            fill: #2c3e50;
        }

        .grid-line {
            stroke: #ecf0f1;
            stroke-width: 1;
            stroke-dasharray: 5,5;
        }

        .legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .tooltip {
            position: absolute;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 300px;
            z-index: 1000;
        }

        .tooltip h3 {
            margin: 0 0 8px 0;
            color: #3498db;
        }

        .insights {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-radius: 15px;
            color: white;
        }

        .insights h3 {
            margin-top: 0;
            font-size: 1.5em;
        }

        .insights ul {
            list-style-type: none;
            padding-left: 0;
        }

        .insights li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .insights li:before {
            content: "→";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Карта конкурентного ландшафта</h1>
        <p class="subtitle">Интерактивная визуализация позиций конкурентов GeOnline на рынке подготовки к ЕНТ</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="xAxis">Ось X:</label>
                <select id="xAxis">
                    <option value="audience_size">Размер аудитории</option>
                    <option value="pricing">Уровень цен</option>
                    <option value="service_quality">Качество сервиса</option>
                </select>
            </div>
            <div class="control-group">
                <label for="yAxis">Ось Y:</label>
                <select id="yAxis">
                    <option value="specialization" selected>Уровень специализации</option>
                    <option value="market_position">Рыночная позиция</option>
                    <option value="innovation">Инновационность</option>
                </select>
            </div>
            <div class="control-group">
                <label for="bubbleSize">Размер пузырьков:</label>
                <select id="bubbleSize">
                    <option value="audience_overlap" selected>Пересечение с нашей аудиторией</option>
                    <option value="threat_level">Уровень угрозы</option>
                </select>
            </div>
        </div>

        <div id="chart"></div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>Прямые конкуренты (5 предметов)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span>Специализированные (по направлениям)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #27ae60;"></div>
                <span>Косвенные конкуренты</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8e44ad;"></div>
                <span>Неожиданные конкуренты</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2980b9;"></div>
                <span>GeOnline</span>
            </div>
        </div>

        <div class="insights">
            <h3>Ключевые инсайты</h3>
            <ul>
                <li><strong>JUZ40</strong> - безусловный лидер рынка с наибольшим охватом аудитории (218K в Instagram)</li>
                <li><strong>Высокое пересечение аудиторий</strong> - все топ-конкуренты работают с одним сегментом (10-11 классы, грант)</li>
                <li><strong>Ценовая война</strong> - разброс от 50K/мес (вы) до 75K/мес (JUZ40), команда считает ваши цены заниженными</li>
                <li><strong>Возможность для дифференциации</strong> - узкая специализация в географии как уникальное преимущество</li>
                <li><strong>Угроза технологизации</strong> - конкуренты инвестируют в платформы и SuperApp решения</li>
            </ul>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Данные конкурентов на основе опроса
        const competitors = [
            {
                name: "JUZ40",
                type: "direct",
                audience_size: 95, // Instagram 218K + другие соцсети
                specialization: 20, // 5 предметов = низкая специализация
                pricing: 80, // 35-75K/месяц
                service_quality: 90,
                market_position: 100,
                innovation: 75,
                audience_overlap: 100, // 5/5 по всем ответам
                threat_level: 95,
                value_prop: "Крупнейший бренд, 69K выпускников, рекорды по комбинациям",
                instagram: "218K",
                model: "Подписочная (35-75K/мес)"
            },
            {
                name: "Edukey",
                type: "direct",
                audience_size: 75, // Instagram 206K
                specialization: 25,
                pricing: 60,
                service_quality: 50, // много жалоб в опросе
                market_position: 70,
                innovation: 60,
                audience_overlap: 85,
                threat_level: 70,
                value_prop: "30K+ поступили на грант",
                instagram: "206K",
                model: "Единоразовая оплата"
            },
            {
                name: "Sabaq Online",
                type: "direct",
                audience_size: 40, // Instagram 29.8K
                specialization: 20,
                pricing: 70,
                service_quality: 75,
                market_position: 60,
                innovation: 50,
                audience_overlap: 80,
                threat_level: 50,
                value_prop: "97% выпускников - грантополучатели",
                instagram: "29.8K",
                model: "Единоразовая оплата"
            },
            {
                name: "Arystan Online",
                type: "direct",
                audience_size: 55, // Instagram 131K
                specialization: 25,
                pricing: 65,
                service_quality: 70,
                market_position: 65,
                innovation: 55,
                audience_overlap: 75,
                threat_level: 60,
                value_prop: "90% учеников на гранте",
                instagram: "131K",
                model: "Годовая подписка"
            },
            {
                name: "Eduser",
                type: "direct",
                audience_size: 45, // Instagram 31.5K
                specialization: 30,
                pricing: 75,
                service_quality: 60,
                market_position: 50,
                innovation: 70,
                audience_overlap: 70,
                threat_level: 55,
                value_prop: "140 баллов из 400 учеников",
                instagram: "31.5K",
                model: "Единоразовая оплата"
            },
            {
                name: "GeoMax",
                type: "specialized",
                audience_size: 15,
                specialization: 95, // Узкая специализация по географии
                pricing: 50,
                service_quality: 65,
                market_position: 30,
                innovation: 40,
                audience_overlap: 60,
                threat_level: 40,
                value_prop: "Специализация только по географии",
                instagram: "~10K",
                model: "Продажа книг + курсы"
            },
            {
                name: "Тарих мектебі",
                type: "specialized",
                audience_size: 25, // Instagram 58.5K
                specialization: 85, // История Казахстана + Всемирная
                pricing: 55,
                service_quality: 80,
                market_position: 45,
                innovation: 65,
                audience_overlap: 50,
                threat_level: 45,
                value_prop: "Лидеры по истории, 140 баллов у 3 учеников",
                instagram: "58.5K",
                model: "Пакетная оплата"
            },
            {
                name: "Zerdeli",
                type: "indirect",
                audience_size: 60,
                specialization: 10, // Офлайн + онлайн
                pricing: 70,
                service_quality: 75,
                market_position: 70,
                innovation: 45,
                audience_overlap: 40,
                threat_level: 60,
                value_prop: "Традиционный офлайн + онлайн форматы",
                instagram: "N/A",
                model: "Смешанная модель"
            },
            {
                name: "Dostyq",
                type: "indirect",
                audience_size: 50,
                specialization: 15,
                pricing: 65,
                service_quality: 70,
                market_position: 60,
                innovation: 40,
                audience_overlap: 35,
                threat_level: 50,
                value_prop: "Широкая сеть офлайн центров",
                instagram: "N/A",
                model: "Офлайн центры"
            },
            {
                name: "NFactorial",
                type: "unexpected",
                audience_size: 35,
                specialization: 40,
                pricing: 85,
                service_quality: 85,
                market_position: 40,
                innovation: 95,
                audience_overlap: 20,
                threat_level: 75,
                value_prop: "IT-экспертиза, сильная техническая база",
                instagram: "Strong tech base",
                model: "Потенциально подписочная"
            },
            {
                name: "GeOnline",
                type: "our_company",
                audience_size: 25, // Предполагаемый размер
                specialization: 100, // Максимальная специализация по географии
                pricing: 40, // 50K/месяц - команда считает заниженным
                service_quality: 85, // Персональный подход
                market_position: 35,
                innovation: 70, // SuperApp в разработке
                audience_overlap: 100,
                threat_level: 0,
                value_prop: "10 лет экспертности в географии, каждый 3-й ученик 40+",
                instagram: "Developing",
                model: "200K за 4 месяца"
            }
        ];

        const colorScale = {
            'direct': '#e74c3c',
            'specialized': '#f39c12', 
            'indirect': '#27ae60',
            'unexpected': '#8e44ad',
            'our_company': '#2980b9'
        };

        let currentData = [...competitors];
        
        const margin = {top: 40, right: 60, bottom: 80, left: 80};
        const width = 1200 - margin.left - margin.right;
        const height = 600 - margin.bottom - margin.top;

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Создаем шкалы
        const xScale = d3.scaleLinear().range([0, width]);
        const yScale = d3.scaleLinear().range([height, 0]);
        const rScale = d3.scaleSqrt().range([8, 35]);

        // Добавляем сетку
        function addGrid() {
            // Вертикальные линии сетки
            g.selectAll(".grid-line.vertical")
                .data(xScale.ticks(8))
                .enter()
                .append("line")
                .attr("class", "grid-line vertical")
                .attr("x1", d => xScale(d))
                .attr("x2", d => xScale(d))
                .attr("y1", 0)
                .attr("y2", height);

            // Горизонтальные линии сетки
            g.selectAll(".grid-line.horizontal")
                .data(yScale.ticks(8))
                .enter()
                .append("line")
                .attr("class", "grid-line horizontal")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => yScale(d))
                .attr("y2", d => yScale(d));
        }

        // Добавляем оси
        const xAxisG = g.append("g")
            .attr("transform", `translate(0,${height})`)
            .attr("class", "axis");

        const yAxisG = g.append("g")
            .attr("class", "axis");

        // Подписи осей
        const xAxisLabel = g.append("text")
            .attr("class", "axis-label")
            .attr("text-anchor", "middle")
            .attr("x", width / 2)
            .attr("y", height + 50);

        const yAxisLabel = g.append("text")
            .attr("class", "axis-label")
            .attr("text-anchor", "middle")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2)
            .attr("y", -50);

        // Tooltip
        const tooltip = d3.select("#tooltip");

        function updateChart() {
            const xAttr = document.getElementById('xAxis').value;
            const yAttr = document.getElementById('yAxis').value;
            const sizeAttr = document.getElementById('bubbleSize').value;

            // Обновляем домены шкал
            xScale.domain([0, d3.max(currentData, d => d[xAttr]) + 10]);
            yScale.domain([0, d3.max(currentData, d => d[yAttr]) + 10]);
            rScale.domain([0, d3.max(currentData, d => d[sizeAttr])]);

            // Обновляем оси
            xAxisG.transition().duration(750).call(d3.axisBottom(xScale));
            yAxisG.transition().duration(750).call(d3.axisLeft(yScale));

            // Обновляем подписи осей
            const axisLabels = {
                'audience_size': 'Размер аудитории (Instagram подписчики, тыс.)',
                'specialization': 'Уровень специализации (% предметов)',
                'pricing': 'Уровень цен (относительный)',
                'service_quality': 'Качество сервиса (оценка команды)',
                'market_position': 'Рыночная позиция (доля рынка)',
                'innovation': 'Инновационность (технологии)',
                'audience_overlap': 'Пересечение аудитории (%)',
                'threat_level': 'Уровень угрозы (%)'
            };

            xAxisLabel.text(axisLabels[xAttr]);
            yAxisLabel.text(axisLabels[yAttr]);

            // Обновляем пузырьки
            const circles = g.selectAll(".competitor")
                .data(currentData, d => d.name);

            circles.enter()
                .append("circle")
                .attr("class", "competitor")
                .attr("r", 0)
                .merge(circles)
                .on("mouseover", function(event, d) {
                    tooltip
                        .style("opacity", 1)
                        .html(`
                            <h3>${d.name}</h3>
                            <strong>Тип:</strong> ${getTypeLabel(d.type)}<br>
                            <strong>Ценностное предложение:</strong><br>${d.value_prop}<br>
                            <strong>Instagram:</strong> ${d.instagram}<br>
                            <strong>Модель:</strong> ${d.model}<br>
                            <strong>Пересечение аудитории:</strong> ${d.audience_overlap}%
                        `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                })
                .transition()
                .duration(750)
                .attr("cx", d => xScale(d[xAttr]))
                .attr("cy", d => yScale(d[yAttr]))
                .attr("r", d => rScale(d[sizeAttr]))
                .attr("fill", d => colorScale[d.type])
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .attr("opacity", 0.8);

            circles.exit()
                .transition()
                .duration(750)
                .attr("r", 0)
                .remove();

            // Обновляем подписи
            const labels = g.selectAll(".competitor-label")
                .data(currentData, d => d.name);

            labels.enter()
                .append("text")
                .attr("class", "competitor-label")
                .merge(labels)
                .transition()
                .duration(750)
                .attr("x", d => xScale(d[xAttr]))
                .attr("y", d => yScale(d[yAttr]) + rScale(d[sizeAttr]) + 15)
                .text(d => d.name);

            labels.exit().remove();
        }

        function getTypeLabel(type) {
            const labels = {
                'direct': 'Прямой конкурент',
                'specialized': 'Специализированный',
                'indirect': 'Косвенный конкурент',
                'unexpected': 'Неожиданный конкурент',
                'our_company': 'Наша компания'
            };
            return labels[type];
        }

        // Обработчики событий для элементов управления
        document.getElementById('xAxis').addEventListener('change', updateChart);
        document.getElementById('yAxis').addEventListener('change', updateChart);
        document.getElementById('bubbleSize').addEventListener('change', updateChart);

        // Первоначальное построение
        addGrid();
        updateChart();
    </script>
</body>
</html>
